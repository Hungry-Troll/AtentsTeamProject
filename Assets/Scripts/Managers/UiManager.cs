using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using static Define;

public class UiManager
{
    // HpMp바
    public GameObject _hpMpBar;

    // 씬 버튼
    public GameObject _sceneButton;

    // 조이스틱
    public JoyStickController _joyStickController;
    public GameObject _joyStick;

    // 인벤토리
    public InventoryController _inventoryController;
    public GameObject _inven;

    // 공격 타겟 몬스터
    public GameObject targetMonster;

    //Ui 관리는 여기에서 처리
    public void Init()
    {
        // 시작하면 HpMp바 씬에 불러옴
        GameObject hpMpBar = GameManager.Resource.GetUi("Ui_HpMpBar");
        _hpMpBar = GameObject.Instantiate<GameObject>(hpMpBar);

        // 시작하면 씬 버튼(공격 스킬 버튼) 씬에 불러옴
        GameObject sceneButton = GameManager.Resource.GetUi("Ui_Scene_Button");
        _sceneButton = GameObject.Instantiate<GameObject>(sceneButton);

        // 시작하면 조이스틱 씬에 불러옴
        GameObject joystick = GameManager.Resource.GetUi("Ui_JoystickController");
        _joyStick = GameObject.Instantiate<GameObject>(joystick);
         _joyStickController = _joyStick.GetComponentInChildren<JoyStickController>();

        // 시작하면 인벤토리버튼(가방아이콘) 씬에 불러옴
        GameObject invenButton = GameManager.Resource.GetUi("Ui_SceneInventoryButton");
        GameObject.Instantiate<GameObject>(invenButton);

        // 시작하면 인벤토리를 미리 불러와서 우선 SetActive(false)로 함
        GameObject inven = GameManager.Resource.GetUi("Ui_Inventory");
        _inven = GameObject.Instantiate<GameObject>(inven);
        _inventoryController = _inven.GetComponentInChildren<InventoryController>();
        InventoryClose();
    }
    /// <summary>
    /// 인벤토리 관련
    /// </summary>
    public void InventoryOpen()
    {
        _inventoryController.gameObject.SetActive(true);
    }

    public void InventoryClose()
    {
        _inventoryController.gameObject.SetActive(false);
    }

    /// <summary>
    /// 이하 씬 Attack버튼 관련
    /// </summary>
    public void AttackButton()
    {
        List<float> targetDistance = new List<float>();
        float distance = 0;
        targetMonster = null;

        // 몬스터들을 찾는다 >> 추후 몬스터 리스폰 시 오브젝트매니저에서 몬스터를 들고있게 할 예정 그러면 파인드 사용 안해도 됨.
        // 각각의 몬스터들의 거리 비교
        GameObject[] monster = GameObject.FindGameObjectsWithTag("Monster");
        for(int i = 0; i < monster.Length; i++)
        {
            targetDistance.Add(Vector3.Distance(monster[i].transform.position, GameManager.Obj._playerController.transform.position));
            
            if(distance < targetDistance[i])
            {
                distance = targetDistance[i];
                targetMonster = monster[i];
            }
        }

        // 가까운 몬스터를 찾았으면 가까이 이동하거나 공격한다.
        if(targetMonster != null)
        {
            // 가까이 있으면 공격한다.
            if (distance < 2.0f)
            {
                // 플레이어 컨트롤러에서 처리
                GameManager.Obj._playerController._creatureState = CreatureState.Attack;
            }
            // 멀리 있으면 이동한다.
            if (distance >= 2.0f)
            {
                // 플레이어 컨트롤러에서 처리
                GameManager.Obj._playerController._creatureState = CreatureState.AutoMove;
            }
        }


    }
    public void Skill1Button()
    {

    }
    public void Skill2Button()
    {

    }

    public void Skill3Button()
    {

    }

    public void RollingButton()
    {

    }
}
